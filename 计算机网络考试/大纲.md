# TCP/IP和OSI分层模型

| TCP/IP                                                       | OSI Model                                                    | Protocols                                                    |
| :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| [Application Layer](https://www.geeksforgeeks.org/application-layer-in-osi-model/) | [Application Layer](https://www.geeksforgeeks.org/application-layer-in-osi-model/) | DNS, DHCP, FTP, HTTPS, IMAP, LDAP, NTP,POP3, RTP, RTSP, SSH, SIP, SMTP, SNMP, Telnet, TFTP |
|                                                              | [Presentation Layer](https://www.geeksforgeeks.org/presentation-layer-in-osi-model/) | JPEG, MIDI, MPEG, PICT, TIFF                                 |
|                                                              | [Session Layer](https://www.geeksforgeeks.org/session-layer-in-osi-model/) | NetBIOS, NFS, PAP, SCP, SQL, ZIP                             |
| [Transport Layer](https://www.geeksforgeeks.org/transport-layer-responsibilities/) | [Transport Layer](https://www.geeksforgeeks.org/transport-layer-responsibilities/) | TCP, UDP                                                     |
| [Internet Layer](https://www.geeksforgeeks.org/network-layer-gq/) | [Network Layer](https://www.geeksforgeeks.org/network-layer-gq/) | ICMP, IGMP, IPsec, IPv4, IPv6, IPX, RIP                      |
| [Link Layer](https://www.geeksforgeeks.org/data-link-layer/) | [Data Link Layer](https://www.geeksforgeeks.org/data-link-layer/) | ARP, ATM, CDP, FDDI, Frame Relay, HDLC, MPLS, PPP, STP, Token Ring |
|                                                              | [Physical Layer](https://www.geeksforgeeks.org/physical-layer-in-osi-model/) | Bluetooth, Ethernet, DSL, ISDN, 802.11 Wi-Fi                 |

![IMG_1238](期末.assets/IMG_1238.PNG)

# 协议

| Network Protocol                                             | Description                                                  | Port number of protocol |
| :----------------------------------------------------------- | :----------------------------------------------------------- | :---------------------- |
| [Ethernet](https://www.geeksforgeeks.org/local-area-network-lan-technologies/) | A family of protocols that specify how devices on the same network segment format and transmit data. | 44818, 2222             |
| [Wi-Fi or WLAN](https://www.geeksforgeeks.org/what-is-wi-fiwireless-fidelity/) | A family of protocols that deal with wireless transm­ission. | –                       |
| [TCP](https://www.geeksforgeeks.org/what-is-transmission-control-protocol-tcp/) | Splits data into packets (reassembles later). Error checking is also included, as the acknowledgment is expected to be sent within a specified timeframe. | 22                      |
| [UDP](https://www.geeksforgeeks.org/user-datagram-protocol-udp/) | User Datagram Protocol                                       | 4096-65535              |
| [IP](https://www.geeksforgeeks.org/what-is-an-ip-address/)   | Every device has an IP address. Packets are “addressed” to ensure they reach the correct user. | –                       |
| [HTTP](https://www.geeksforgeeks.org/http-full-form/)        | Used to access web pages from a web server.                  | 80                      |
| HTTP’S                                                       | uses encryption to protect data.                             | 443                     |
| [FTP](https://www.geeksforgeeks.org/file-transfer-protocol-ftp/) | File Transfer Protocol: Handles file uploads and downloads, transferring data and programs. | 21                      |
| [SMTP](https://www.geeksforgeeks.org/simple-mail-transfer-protocol-smtp/) | SMTP server has a database of user email addresses. Internet Message Access Protocol: Handles incoming mail. | 587                     |
| [IMAP](https://www.geeksforgeeks.org/internet-message-access-protocol-imap/) | Internet Message Access Protocol: Process incoming mail.     | 993                     |
| [ARP](https://www.geeksforgeeks.org/how-address-resolution-protocol-arp-works/) | ARP finds a host’s hardware address (also known as MAC (Media Access Control) address) based on its known IP address. | –                       |
| [DNS](https://www.geeksforgeeks.org/domain-name-system-dns-in-application-layer/) | DNS is the host name for the IP address translation service. DNS is a distributed database implemented on a hierarchy of name servers. It is an application layer protocol for messaging between clients and servers. | 53                      |
| [FTPS](https://www.geeksforgeeks.org/difference-between-ftps-and-sftp/) | FTPS is known as FTP SSL which refers to[ File Transfer Protocol (FTP) ](https://www.geeksforgeeks.org/file-transfer-protocol-ftp-in-application-layer/)over [Secure Sockets Layer (SSL) ](https://www.geeksforgeeks.org/secure-socket-layer-ssl/)which is more secure from FTP. FTPS also called as File Transfer Protocol Secure. | 21                      |
| [POP3](https://www.geeksforgeeks.org/differences-between-pop3-and-imap/) | POP3 is a simple protocol that only allows downloading messages from your Inbox to your local computer. | 110                     |
| [SIP](https://www.geeksforgeeks.org/session-initiation-protocol/) | [Session Initiation Protocol](https://www.geeksforgeeks.org/difference-between-sip-and-voip/) was designed by IETF and is described in RFC 3261. It’s the protocol of [application layer](https://www.geeksforgeeks.org/protocols-application-layer/) that describes the way to found out Internet telephone calls, video conferences and other multimedia connections, manage them and terminate them. | 5060,5061               |
| [SMB](https://www.geeksforgeeks.org/introduction-to-microsoft-smb-a-network-file-sharing-protocol/) | The SMB protocol was developed by Microsoft for direct file sharing over local networks. | 139                     |
| [SNMP](https://www.geeksforgeeks.org/simple-network-management-protocol-snmp/) | SNMP is an application layer protocol that uses UDP port numbers 161/162. SNMP is also used to monitor networks, detect network errors, and sometimes configure remote devices. | 161                     |
| [SSH](https://www.geeksforgeeks.org/introduction-to-sshsecure-shell-keys/) | SSH (Secure Shell) is the permissions used by the SSH protocol. That is, a cryptographic network protocol used to send encrypted data over a network. | 22                      |
| [VNC](https://www.geeksforgeeks.org/fundamentals-of-virtual-networking/) | VNC stands for Virtual Network Communication.                | 5900                    |
| [RPC](https://www.geeksforgeeks.org/remote-procedure-call-rpc-in-operating-system/) | Remote Procedure Call (RPC) is a powerful technique for building distributed client-server based applications. It is based on extending traditional calls to local procedures so that the called procedure does not have to be in the same address space as the calling procedure. | 1024 to 5000            |
| [NFS](https://www.geeksforgeeks.org/network-file-system-nfs/) | NFS uses file handles to uniquely identify the file or directory on which the current operation is being performed. Internet Control Message Protocol (ICMP) to provide error control. Used for reporting errors and administrative queries. | 2049                    |
| [ICMP](https://www.geeksforgeeks.org/internet-control-message-protocol-icmp/) | Internet Control Message Protocol(ICMP) to provide an error control. It is used for reporting errors and management queries. | –                       |
| [BOOTP](https://www.geeksforgeeks.org/bootstrap-protocol-bootp/) | Bootstrap Protocol (BOOTP) is a network protocol used by network management to assign IP addresses to each member of that network in order to join other network devices through a main server. | 67                      |
| [DHCP](https://www.geeksforgeeks.org/dynamic-host-configuration-protocol-dhcp/) | Dynamic Host Configuration Protocol (DHCP) is an application layer protocol. DHCP is based on a client-server model, based on discoveries, offers, requests, and ACKs. | 68                      |
| [NAT](https://www.geeksforgeeks.org/network-address-translation-nat/) | Network Address Translation (NAT) is the process of translating one or more local IP addresses into one or more global IP addresses, or vice versa, in order to provide Internet access to local hosts. | 5351                    |
| [PPP](https://www.geeksforgeeks.org/point-to-point-protocol-ppp-suite/) | Point-to-Point Protocol (PPP) is basically an asymmetric protocol suite for various connections or links without framing. H. Raw bit pipe. PPP also expects other protocols to establish connections, authenticate users, and carry network layer data as well. | 1994                    |
| [RIP](https://www.geeksforgeeks.org/routing-information-protocol-rip/) | Routing Information Protocol (RIP) is a dynamic routing protocol that uses hop count as a routing metric to find the best path between source and destination networks. | 520                     |
| [OSPF](https://www.geeksforgeeks.org/open-shortest-path-first-ospf-protocol-states/) | Open Shortest Path First (OSPF) is a link-state routing protocol used to find the best path between a source and destination router using its own shortest path first). | 89                      |
| [EIGRP](https://www.geeksforgeeks.org/eigrp-fundamentals/)   | Enhanced Interior Gateway Routing Protocol (EIGRP) is a dynamic routing protocol used to find the best path and deliver packets between any two Layer 3 devices. | 88                      |
| [BGP](https://www.geeksforgeeks.org/border-gateway-protocol-bgp/) | Border Gateway Protocol (BGP) is a protocol used to exchange Internet routing information and is used between ISPs in different ASes. | 179                     |
| [STP](https://www.geeksforgeeks.org/introduction-of-spanning-tree-protocol-stp/) | Spanning Tree Protocol (STP) is used to create a loop-free network by monitoring the network, tracking all connections, and shutting down the least redundant connections. | 0 to 255                |
| [RARP](https://www.geeksforgeeks.org/what-is-rarp/)          | RARP, stand for Reverse Address Resolution Protocol, is a computer network-based protocol used by client computers to request IP addresses from a gateway server’s Address Resolution Protocol table or cache. | –                       |
| [LAPD](https://www.geeksforgeeks.org/link-access-protocol-d-channel-lapd/) | The D-channel LAPD or Link Access Protocol is basically the Layer 2 protocol normally required for the ISDN D-channel. It is derived from the LAPB (Link Access Protocol Balanced) protocol. | –                       |
| [IPsec](https://www.geeksforgeeks.org/ip-security-ipsec/)    | IP Security (IPSec) is a standard suite of Internet Engineering Task Force (IETF) protocols between two communication points on IP networks to provide data authentication, integrity, and confidentiality. It also defines encrypted, decrypted, and authenticated packets. | 4500                    |
| [ASCII](https://www.geeksforgeeks.org/ascii-table/)          | ASCII (American Standard Code for Information Interchange) is the standard character encoding used in telecommunications. The ASCII representation “ask-ee” is strictly a 7-bit code based on the English alphabet. ASCII codes are used to represent alphanumeric data. | 9500                    |

# 网络设备

| Device            | Description                                                  | 中文                                                         |
| :---------------- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| Client            | Any device, such as a workstation, laptop, tablet, or smartphone, that is used to access a network. |                                                              |
| Server            | Provides resources to network users, including email, web pages, or files. |                                                              |
| Hub               | A Layer 1 device that does not perform any inspection of traffic. A [hub](https://www.geeksforgeeks.org/network-devices-hub-repeater-bridge-switch-router-gateways/) simply receives traffic in a port and repeats that traffic out of all the other ports. |                                                              |
| Switch            | A Layer 2 device that makes its forwarding decisions based on the destination [Media Access Control (MAC) address](https://www.geeksforgeeks.org/introduction-of-mac-address-in-computer-network/). A switch learns which devices reside off which ports by examining the source MAC address. The switch then forwards traffic only to the appropriate port, and not to all the other ports. | 一种OSI第2层（数据链路层）设备，它根据目标媒体访问控制 (MAC) 地址做出转发决策。交换机通过检查源 MAC 地址了解哪些设备位于哪些端口。然后，交换机仅将流量转发到适当的端口，而不是所有其他端口。 |
| Router            | A Layer 3 device that makes forwarding decisions based on [Internet Protocol (IP](https://www.geeksforgeeks.org/what-is-an-ip-address/)) addressing. Based on the routing table, the router intelligently forwards the traffic out of the appropriate interface. | 一种OSI第3层（网络层）设备，它根据 Internet 协议 (IP) 寻址做出转发决策。基于路由表，路由器智能地将流量从适当的接口转发出去。 |
| Multilayer switch | Can operate at both [Layer 2 ](https://www.geeksforgeeks.org/switch-functions-at-layer-2/)and [Layer 3](https://www.geeksforgeeks.org/inter-vlan-routing-layer-3-switch/). Also called a Layer 3 switch, a multilayer switch is a high-performance device that can switch traffic within the LAN and for- ward packets between subnets. |                                                              |
| Media             | Media can be copper cabling, [fiber-optic cabling](https://www.geeksforgeeks.org/fiber-optics-and-types/), or radio waves. Media varies in its cost, bandwidth capacity, and distance limitation. |                                                              |
| Analog modem      | Modem is short for [modulator/demodulator.](https://www.geeksforgeeks.org/what-is-modulation/) An analog modem converts the digital signals generated by a computer into analog signals that can travel over conventional phone lines. |                                                              |
| Broadband modem   | A digital modem used with [high-speed DSL ](https://www.geeksforgeeks.org/digital-subscriber-line-dsl/)or cable Internet service. Both operate in a similar manner to the analog modem, but use higher broadband frequencies and transmission speeds. |                                                              |
| Access point (AP) | A network device with a built-in antenna, transmitter, and adapter that provides a connection point between WLANs and a wired Ethernet LAN. APs usually have several wired RJ-45 ports to support LAN clients. Most small office or home office (SOHO) routers integrate an AP. |                                                              |

 # IPv4分类编址

| CLASS                                                        | LEADING BITS | NET ID BITS | HOST ID BITS | 可指派的网络数量     | 可分配的IP地址数量  | START ADDRESS | END ADDRESS     |
| :----------------------------------------------------------- | :----------- | :---------- | :----------- | :------------------- | :------------------ | :------------ | :-------------- |
| [CLASS A](https://www.geeksforgeeks.org/introduction-of-classful-ip-addressing/) | 0            | 8           | 24           | $2^{(8-1)}-2=124$    | $2^{24}-2=16777214$ | 0.0.0.0       | 127.255.255.255 |
| [CLASS B](https://www.geeksforgeeks.org/introduction-of-classful-ip-addressing/) | 10           | 16          | 16           | $2^{(16-2)}=16384$   | $2^{16}-2=65534$    | 128.0.0.0     | 191.255.255.255 |
| [CLASS C](https://www.geeksforgeeks.org/introduction-of-classful-ip-addressing/) | 110          | 24          | 8            | $2^{(24-3)}=2097152$ | $2^{8}-2=254$       | 192.0.0.0     | 223.255.255.255 |
| [CLASS D](https://www.geeksforgeeks.org/introduction-of-classful-ip-addressing/) | 1110         | NOT DEFINED | NOT DEFINED  | NOT DEFINED          | NOT DEFINED         | 224.0.0.0     | 239.255.255.255 |
| [CLASS E](https://www.geeksforgeeks.org/introduction-of-classful-ip-addressing/) | 1111         | NOT DEFINED | NOT DEFINED  | NOT DEFINED          | NOT DEFINED         | 240.0.0.0     | 255.255.255.255 |

![image-20221214175119222](assets/image-20221214175119222.png)



- 每一类地址都由两个固定长度的字段组成，其中一个字段是**网络号 net-id**，它标志主机（或路由器）所连接到的网络，而另一个字段则是**主机号 host-id**，它标志该主机（或路由器）。

- 主机号在它前面的网络号所指明的网络范围内必须是唯一的。

- 由此可见，**一个 IP 地址在整个互联网范围内是唯一的**。



#### A类地址

$$
可指派的网络数量为 ： 2^{(8-1)}-2=124\\
（除去最小网络号和最大网络号）
$$

$$
每个网络中可分配的IP地址数量为 ： 2^{24}-2=16777214
$$

![image-20211202231437661](assets/x4aphIEDC1vnKGb.png)





#### B类地址

$$
可指派的网络数量为 ： 2^{(16-2)}=16384
$$

$$
每个网络中可分配的IP地址数量为 ： 2^{16}-2=65534
$$

![image-20211202224753831](assets/1vQROY7LxkZEohJ.png)

注意：

有些教材中指出128.0是保留网络号，B类第一个可指派的网络号为128.1。
但根据2002年9月发表的RFC 3330文档，128.0网络号已经可以分配了。



#### C类地址

$$
可指派的网络数量为 ： 2^{(24-3)}=2097152
$$

$$
每个网络中可分配的IP地址数量为 ： 2^{8}-2=254
$$

![image-20211202224416423](assets/qmSFA6ClyxDJEYp.png)

注意：

有些教材中指出192.0.0是保留网络号，C类第一个可指派的网络号为192.0.1。
但根据2002年9月发表的RFC 3330文档，192.0.0网络号已经可以分配了。只不过目前还没有分配出去。





# 考点预测



## IPv4子网分配



## 路由选择协议



## TCP拥塞控制





## IPv6

![img](期末.assets/v2-8615026672e5c73a2c3e39c63a484a3f_1440w.jpg)

![动图](期末.assets/v2-48a0d2a6c441291442700b8e28d09c77_b.webp)





## DNS

DNS通常由其他应用层协议使用(如HTTP、SMTP、FTP)，将主机名解析为IP地址，其运行在UDP（非连接）之上，使用53号端口。**DNS除了提供主机名到IP地址转换外，还提供如下服务：主机别名、邮件服务器别名、负载分配等**

### DNS报文格式

DNS只有两种报文：查询报文、回答报文，两者有着相同格式，如下：

![img](期末.assets/9112803_1337243125YfCr.png)



### **首部区域**

**标识数**

  对该查询进行标识，该标识会被复制到对应的回答报文中，客户机用它来匹配发送的请求与接收到的回答。

**标志[1]**

![img](期末.assets/9112803_1337243125kk5k.png)

图3 DNS报文首部区域的标志

> **QR(1比特)：**查询/响应的标志位，1为响应，0为查询。
>
> **opcode(4比特)：**定义查询或响应的类型(若为0则表示是标准的，若为1则是反向的，若为2则是服务器状态请求)。
>
> **AA(1比特)：**授权回答的标志位。该位在响应报文中有效，1表示名字服务器是权限服务器(关于权限服务器以后再讨论)
>
> **TC(1比特)：**截断标志位。1表示响应已超过512字节并已被截断(依稀好像记得哪里提过这个截断和UDP有关，先记着)
>
> **RD(1比特)：**该位为1表示客户端希望得到递归回答(递归以后再讨论)
>
> **RA(1比特)：**只能在响应报文中置为1，表示可以得到递归响应。
>
> **zero(3比特)：**不说也知道都是0了，保留字段。
>
> **rcode(4比特)：**返回码，表示响应的差错状态，通常为0和3，各取值含义如下：

> > 0 无差错 
> >
> > 1 格式差错 
> >
> > 2 问题在域名服务器上 
> >
> > 3 域参照问题 
> >
> > 4 查询类型不支持 
> >
> > 5 在管理上被禁止 
> >
> > 6 -- 15 保留 

**问题数、回答RR数、权威RR数、附加RR数**

  这四个字段都是两字节，分别对应下面的查询问题、回答、授权和附加信息部分的**数量**。一般问题数都为1，DNS查询报文中，资源记录数、授权资源记录数和附加资源记录数都为0[1]。 

### **区域**

#### **问题区域**

  包含正在进行的查询信息。包含查询名(被查询主机名字的名字字段)、查询类型、查询类。

![img](期末.assets/9112803_1337243126ZnLZ.png)

图4 DNS报文的问题区域

##### **查询名**

  查询名部分长度不定，一般为要查询的域名(也会有IP的时候，即反向查询)。此部分**由一个或者多个标示符序列组成**，每个标示符以首字节数的计数值来说明该标示符长度，每个名字以0结束。计数字节数必须是0~63之间。该字段无需填充字节。还是借个例子来说明更直观些，查询名为gemini.tuc.noao.edu的话，查询名字段如下[1]：

![img](期末.assets/9112803_1337243127s5l2.png)

图5 DNS报文问题区别的查询名

##### **查询类型**

  通常查询类型为A(由名字获得IP地址)或者PTR(获得IP地址对应的域名)，类型列表如下：

| ***\*类型\**** | ***\*助记符\**** | ***\*说明\****                             |
| -------------- | ---------------- | ------------------------------------------ |
| 1              | A                | IPv4地址                                   |
| 2              | NS               | 名字服务器                                 |
| 5              | CNAME            | 规范名称定义主机的正式名字的别名           |
| 6              | SOA              | 开始授权标记一个区的开始                   |
| 11             | WKS              | 熟知服务定义主机提供的网络服务             |
| 12             | PTR              | 指针把IP地址转化为域名                     |
| 13             | HINFO            | 主机信息给出主机使用的硬件和操作系统的表述 |
| 15             | MX               | 邮件交换把邮件改变路由送到邮件服务器       |
| 28             | AAAA             | IPv6地址                                   |
| 252            | AXFR             | 传送整个区的请求                           |
| 255            | ANY              | 对所有记录的请求                           |

   NS记录指定了名字服务器。一般情况，每个DNS数据库中，针对每个顶级域都会有一条NS记录，这样一来，电子邮件就可以被发送到域名树中远处的部分。

##### **查询类**

  通常为1，指Internet数据。

#### **回答、权威、附加区域**

 回答区域包含了最初请求名字的资源记录，一个回答报文的回答区域可以包含多条资料记录RR(**因为一个主机名可以对应多个IP地址，冗余Web服务器**)。

权威区域包含了其他权威DNS服务器的记录。附加区域包含其他一些"有帮助"的记录，

例如，对于一个MX(邮件交换)请求的回答报文中，回答区域包含一条资料记录(该记录提供邮件服务器的规范主机名)，附加区域可以包含一条类型A记录(该记录提供了该邮件服务器的规范主机名的IP地址)。

  每条资料记录是一个五元组，如下：

**(域名，生存期，类别，类型，值)**

直接表示如下[1]：

![img](期末.assets/9112803_1337243128BnDB.png)

图6 DNS报文的资源记录

##### **域名(2字节或不定长)**

  记录中资源数据对应的名字，它的格式和查询名字段格式相同。当报文中域名重复出现时，就需要使用2字节的偏移指针来替换。例如，在资源记录中，域名通常是查询问题部分的域名的重复，就需要用指针指向查询问题部分的域名。关于指针怎么用，TCP/IP详解里面有，即2字节的指针，最前面的两个高位是11，用于识别指针。其他14位从报文开始处计数(从0开始)，指出该报文中的相应字节数。注意，DNS报文的第一个字节是字节0，第二个报文是字节1。一般响应报文中，资源部分的域名都是指针C00C(11**00000000001100，12正好是首部区域的长度**)，刚好指向请求部分的域名[1]。

##### **类型(记录的类型，见表1)**

  A记录，Name是主机名，Value是该主机名的IP地址，因此，一条类型为A的资源记录提供了标准的主机名到IP地址的映射。

  NS记录，Name是域(如foo.com)，Value是知道如何获得该域中主机IP地址的权威DNS服务器的主机名(如dns.foo.com)，这个记录常用于沿着查询链进一步路由DNS查询。

  CNAME记录，Name是主机别名，Value是主机别名对应的**规范主机名**，该记录能够向请求主机提供一个主机名对应的规范主机名。

  MX记录，Name是邮件服务器别名，Value是邮件服务器别名的规范主机名。通过MX记录，一个公司的邮件服务器和其他服务器可以使用相同的别名。

  注：有着复杂主机名的主机能拥有多个别名，前者称为规范主机名，后者称为主机别名(便于记忆)。

##### **类**

  对于Internet信息，它总是IN。

##### **生存时间**

  用于指示该记录的稳定程度，极为稳定的信息会被分配一个很大的值(如86400，一天的秒数)。该字段表示资源记录的生命周期(以秒为单位)，一般用于当地址解析程序取出资源记录后决定保存及使用缓存数据的时间[1]。

##### **资源数据长度(2字节)**

  表示资源数据的长度(以字节为单位，如果资源数据为IP则为0004)。 

##### **资源数据**

  该字段是可变长字段，表示按查询段要求返回的相关资源记录的数据